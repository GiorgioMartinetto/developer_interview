upstream fastapi_app {  # Definisce un gruppo di server backend chiamato "fastapi_app" usato da proxy_pass
    server app:8000;  # Indirizzo e porta del container/app FastAPI (modificare secondo il docker-compose)
}  # Fine del blocco upstream

server{  # Inizio del blocco server che gestisce le richieste HTTP in arrivo
    listen 80;  # Porta su cui Nginx ascolta le richieste HTTP
    server_name _;  # Nome del server; "_" indica un catch-all per richieste non specifiche

    location / {  # Gestisce tutte le richieste verso la root e sotto-percorsi
        proxy_pass http://fastapi_app;  # Inoltra le richieste al gruppo upstream definito sopra
        proxy_set_header Host $host;  # Trasmette al backend l'intestazione Host originale del client
        proxy_set_header X-Real-IP $remote_addr;  # Passa l'indirizzo IP reale del client al backend
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # Mantiene la catena di IP dei proxy/client per logging
        proxy_set_header X-Forwarded-Proto $scheme;  # Indica al backend se la richiesta originale era http o https
    }
}